<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - PillPilot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="logo-text">
                        <h1>PillPilot</h1>
                        <span class="tagline">Medicine Inventory Management</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Analytics Page -->
        <div class="page-section">
            <div class="page-header">
                <a href="{{ url_for('index') }}" class="back-button">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <h2><i class="fas fa-chart-line"></i> Analytics Dashboard</h2>
                <p>Comprehensive inventory analysis and insights</p>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-bar"></i> Stock Overview</h3>
                        <div id="stockByStoreChart"></div>
                    </div>
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-pie"></i> Status Distribution</h3>
                        <div id="stockStatusChart"></div>
                    </div>
                </div>
            </div>

            <!-- New Business Critical Charts -->
            <div class="business-charts-section">
                <h2><i class="fas fa-business-time"></i> Business Critical Analytics</h2>
                <p class="section-description">Key visualizations for operational decision-making and risk management</p>
                
                <div class="business-charts-grid">
                    <!-- Stock Aging Timeline -->
                    <div class="business-chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-clock"></i> Stock Aging / Expiry Timeline</h3>
                            <div class="chart-badge critical">Compliance Risk</div>
                        </div>
                        <p class="chart-description">Track medicine expiry timeline to prevent losses and ensure compliance. Critical for pharmacy operations.</p>
                        <div class="chart-metrics" id="agingMetrics">
                            <div class="metric">
                                <span class="metric-label">Value at Risk (90 days)</span>
                                <span class="metric-value" id="valueAtRisk">-</span>
                            </div>
                        </div>
                        <div id="stockAgingChart" class="business-chart-container"></div>
                    </div>

                    <!-- Stockout Risk Forecast -->
                    <div class="business-chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Stockout Risk Forecast</h3>
                            <div class="chart-badge warning">Service Risk</div>
                        </div>
                        <p class="chart-description">Predict potential stockouts to prevent service disruptions. Essential for maintaining customer trust.</p>
                        <div class="chart-metrics" id="stockoutMetrics">
                            <div class="metric">
                                <span class="metric-label">Critical Items</span>
                                <span class="metric-value" id="criticalItemsCount">-</span>
                            </div>
                        </div>
                        <div id="stockoutRiskChart" class="business-chart-container"></div>
                    </div>

                    <!-- Transfer Opportunity Map -->
                    <div class="business-chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-exchange-alt"></i> Transfer Opportunity Map</h3>
                            <div class="chart-badge success">Cost Savings</div>
                        </div>
                        <p class="chart-description">Identify opportunities to move surplus stock to deficit locations. Maximizes inventory efficiency and reduces waste.</p>
                        <div class="chart-metrics" id="transferMetrics">
                            <div class="metric">
                                <span class="metric-label">Savings Potential</span>
                                <span class="metric-value" id="savingsPotential">-</span>
                            </div>
                        </div>
                        <div id="transferOpportunityChart" class="business-chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- Enterprise Charts Section -->
            <div class="enterprise-charts">
                <!-- Risk Matrix Heatmap -->
                <div class="enterprise-chart-card">
                    <div class="chart-header">
                        <h3><i class="fas fa-th"></i> Risk Matrix Heatmap</h3>
                        <div class="chart-controls">
                            <select id="matrixView" class="chart-control">
                                <option value="category">By Category (17 categories)</option>
                                <option value="medicine">By Medicine (Top 50)</option>
                            </select>
                            <select id="matrixMetric" class="chart-control">
                                <option value="risk">Risk Score</option>
                                <option value="expiry">Days to Expiry</option>
                                <option value="quantity">Stock Quantity</option>
                            </select>
                        </div>
                    </div>
                    <p class="chart-description">Regional vs product category analysis. Darker colors indicate higher risk areas requiring attention.</p>
                    <div id="riskMatrixHeatmap" class="enterprise-chart-container"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Load analytics charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadCharts();
            loadEnterpriseCharts();
        });
    </script>
</body>
</html>
